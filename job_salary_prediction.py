# -*- coding: utf-8 -*-
"""Job_Salary_Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1CDl8-GWFRwxEvUgmragVairgu6nysLmq

# Job Salary Prediction using Machine Learning

## Objective
The objective of this project is to analyze job-related data and build a machine learning model
to predict salaries based on factors such as job title, location, experience, and skills.

## Tools & Technologies
- Python
- Pandas, NumPy
- Matplotlib, Seaborn
- Scikit-learn

## Platform
Google Colab
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

import os
os.listdir()

df = pd.read_csv('/content/sample_data/data_science_salaries.csv')
df.head()

## Data Understanding

df.shape

df.columns

df.info()

"""### Target Variable Selection

In this project, `salary_in_usd` is selected as the target variable because it
provides a standardized salary value across different countries and currencies,
making it suitable for predictive modeling.

## Exploratory Data Analysis (EDA)

EDA helps in understanding salary distributions, trends, and relationships
between different job-related features and salary in USD.
"""

plt.figure(figsize=(8,5))
sns.histplot(df['salary_in_usd'], bins=30)
plt.title('Distribution of Salaries (USD)')
plt.xlabel('Salary in USD')
plt.ylabel('Frequency')
plt.show()

plt.figure(figsize=(8,5))
sns.boxplot(x='experience_level', y='salary_in_usd', data=df)
plt.title('Salary vs Experience Level')
plt.xlabel('Experience Level')
plt.ylabel('Salary in USD')
plt.show()

top_jobs = df.groupby('job_title')['salary_in_usd'].mean().sort_values(ascending=False).head(10)

plt.figure(figsize=(10,6))
top_jobs.plot(kind='bar')
plt.title('Top 10 Job Titles by Average Salary')
plt.xlabel('Job Title')
plt.ylabel('Average Salary in USD')
plt.xticks(rotation=45, ha='right')
plt.show()

df.isnull().sum()

df.nunique()

import matplotlib.pyplot as plt

df.groupby('work_models')['salary_in_usd'].mean().plot(kind='bar')
plt.ylabel('Average Salary (USD)')
plt.title('Average Salary by Work Model')
plt.show()

df.groupby('company_size')['salary_in_usd'].median().plot(kind='bar')
plt.ylabel('Median Salary (USD)')
plt.title('Median Salary by Company Size')
plt.show()

y = df['salary_in_usd']

X = df.drop(['salary', 'salary_currency', 'salary_in_usd'], axis=1)

# Drop rows where salary_in_usd is missing
df = df.dropna(subset=['salary_in_usd'])

# Check shape after dropping
df.shape

df.isnull().sum()

# Target variable
y = df['salary_in_usd']

# Feature variables (drop target and raw salary)
X = df.drop(['salary_in_usd', 'salary'], axis=1)

X.head()

# Identify categorical and numerical columns
categorical_cols = X.select_dtypes(include='object').columns
numerical_cols = X.select_dtypes(exclude='object').columns

categorical_cols, numerical_cols

# One-hot encode categorical variables
X_encoded = pd.get_dummies(X, columns=categorical_cols, drop_first=True)

X_encoded.head()

X_encoded.shape

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X_encoded, y,
    test_size=0.2,
    random_state=42
)

X_train.shape, X_test.shape

from sklearn.linear_model import LinearRegression

# Initialize model
lr = LinearRegression()

# Train model
lr.fit(X_train, y_train)

y_pred = lr.predict(X_test)

from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
import numpy as np

mae = mean_absolute_error(y_test, y_pred)
rmse = np.sqrt(mean_squared_error(y_test, y_pred))
r2 = r2_score(y_test, y_pred)

mae, rmse, r2

# Pick one sample from test data
sample_X = X_test.iloc[[0]]   # double [[]] is important
sample_y_actual = y_test.iloc[0]

sample_y_pred = lr.predict(sample_X)

print("Actual Salary (USD):", sample_y_actual)
print("Predicted Salary (USD):", sample_y_pred[0])

# Compare first 5 predictions
comparison = pd.DataFrame({
    "Actual Salary": y_test[:5].values,
    "Predicted Salary": y_pred[:5]
})

comparison

from sklearn.ensemble import RandomForestRegressor

# Initialize model
rf = RandomForestRegressor(
    n_estimators=100,
    random_state=42,
    n_jobs=-1
)

rf.fit(X_train, y_train)

y_pred_rf = rf.predict(X_test)

mae_rf = mean_absolute_error(y_test, y_pred_rf)
rmse_rf = np.sqrt(mean_squared_error(y_test, y_pred_rf))
r2_rf = r2_score(y_test, y_pred_rf)

mae_rf, rmse_rf, r2_rf

results = pd.DataFrame({
    "Model": ["Linear Regression", "Random Forest"],
    "MAE": [mae, mae_rf],
    "RMSE": [rmse, rmse_rf],
    "R2 Score": [r2, r2_rf]
})

results

# Log transform the target
y_log = np.log1p(y)   # log(1 + y) to safely handle zero values

X_train, X_test, y_train_log, y_test_log = train_test_split(
    X_encoded, y_log,
    test_size=0.2,
    random_state=42
)

lr_log = LinearRegression()
lr_log.fit(X_train, y_train_log)

# Predict in log scale
y_pred_log = lr_log.predict(X_test)

# Convert back to original salary scale
y_pred_exp = np.expm1(y_pred_log)
y_test_exp = np.expm1(y_test_log)

mae_log = mean_absolute_error(y_test_exp, y_pred_exp)
rmse_log = np.sqrt(mean_squared_error(y_test_exp, y_pred_exp))
r2_log = r2_score(y_test_exp, y_pred_exp)

mae_log, rmse_log, r2_log

sample_pred_log = lr_log.predict(sample_X)
sample_pred_salary = np.expm1(sample_pred_log)

print("Actual Salary (USD):", sample_y_actual)
print("Predicted Salary after log transform (USD):", round(sample_pred_salary[0]))

comparison_log = pd.DataFrame({
    "Model": ["Linear Regression (Original Target)",
              "Linear Regression (Log-Transformed Target)"],
    "MAE": [mae, mae_log],
    "RMSE": [rmse, rmse_log],
    "R2 Score": [r2, r2_log]
})

comparison_log

rf_log = RandomForestRegressor(
    n_estimators=200,
    random_state=42,
    n_jobs=-1
)

rf_log.fit(X_train, y_train_log)

# Predict in log scale
y_pred_rf_log = rf_log.predict(X_test)

# Convert back to original scale
y_pred_rf_exp = np.expm1(y_pred_rf_log)

mae_rf_log = mean_absolute_error(y_test_exp, y_pred_rf_exp)
rmse_rf_log = np.sqrt(mean_squared_error(y_test_exp, y_pred_rf_exp))
r2_rf_log = r2_score(y_test_exp, y_pred_rf_exp)

mae_rf_log, rmse_rf_log, r2_rf_log

final_comparison = pd.DataFrame({
    "Model": [
        "Linear Regression (Original Target)",
        "Linear Regression (Log Target)",
        "Random Forest (Original Target)",
        "Random Forest (Log Target)"
    ],
    "MAE": [
        mae,
        mae_log,
        mae_rf,
        mae_rf_log
    ],
    "RMSE": [
        rmse,
        rmse_log,
        rmse_rf,
        rmse_rf_log
    ],
    "R2 Score": [
        r2,
        r2_log,
        r2_rf,
        r2_rf_log
    ]
})

final_comparison

# Save training column order
trained_columns = X_encoded.columns

def predict_salary(job_title,
                   experience_level,
                   employment_type,
                   work_models,
                   work_year,
                   employee_residence,
                   company_location,
                   company_size):

    # 1. Create input DataFrame
    input_dict = {
        'job_title': job_title,
        'experience_level': experience_level,
        'employment_type': employment_type,
        'work_models': work_models,
        'work_year': work_year,
        'employee_residence': employee_residence,
        'company_location': company_location,
        'company_size': company_size
    }

    input_df = pd.DataFrame([input_dict])

    # 2. One-hot encode input
    input_encoded = pd.get_dummies(input_df)

    # 3. Align columns with training data
    input_encoded = input_encoded.reindex(columns=trained_columns, fill_value=0)

    # 4. Predict log salary
    log_salary_pred = lr_log.predict(input_encoded)

    # 5. Convert back to USD
    salary_pred = np.expm1(log_salary_pred)[0]

    # 6. Return formatted result
    return f"Predicted Salary (USD): ${round(salary_pred):,}"

predict_salary(
    job_title="Data Scientist",
    experience_level="SE",
    employment_type="FT",
    work_models="Remote",
    work_year=2024,
    employee_residence="US",
    company_location="US",
    company_size="L"
)